### AD5X

- [**1. Важные особенности AD5X**](#1-важные-особенности-ad5x)
- [**2. Как подготовить файл в Orca AD5X**](#2-как-подготовить-файл-в-orca-ad5x)
- [**3. Как пользоваться меню выбора цвета (макрос `COLOR`) AD5X**](#3-как-пользоваться-меню-выбора-цвета-макрос-color-ad5x)
- [**4. Меню печати (макрос `PRINT`) AD5X**](#4-меню-печати-макрос-print-ad5x)
- [**5. Как вручную указать принтеру, какая катушка сейчас заправлена AD5X**](#5-как-вручную-указать-принтеру-какая-катушка-сейчас-заправлена-ad5x)
- [**6. Как настроить количество отходов при смене филамента AD5X**](#6-как-настроить-количество-отходов-при-смене-филамента-ad5x)
    - [**Самые важные настройки (что менять чаще всего) AD5X:**](#самые-важные-настройки-что-менять-чаще-всего-ad5x)
      - [**Настройки для продвинутых (не меняйте, если не уверены в результате) AD5X:**](#настройки-для-продвинутых-не-меняйте-если-не-уверены-в-результате-ad5x)
- [**7. Добавить свои типы филамента AD5X**](#7-добавить-свои-типы-филамента-ad5x)
- [**8. Добавить свои цвета AD5X**](#8-добавить-свои-цвета-ad5x)
- [9. Исправление работы с корзиной и ножом для отрезания филамента AD5X](#9-исправление-работы-с-корзиной-и-ножом-для-отрезания-филамента-ad5x)
  - [Настройка корзины AD5X](#настройка-корзины-ad5x)
  - [Настройка ножа AD5X](#настройка-ножа-ad5x)
- [Настройка корзины на родной прошивке AD5X](#настройка-корзины-на-родной-прошивке-ad5x)
- [**10. IFS команды**](#10-ifs-команды)
- [**11. Восстановление прошивки IFS**](#11-восстановление-прошивки-ifs)
- [IFS: sensor error: Serial communication error: read failed: device reports readiness to read but returned no data (device disconnected or multiple access on port?)](#ifs-sensor-error-serial-communication-error-read-failed-device-reports-readiness-to-read-but-returned-no-data-device-disconnected-or-multiple-access-on-port)

[Плагины](https://github.com/ghzserg/g28_tenz/blob/main/Plugin_ru.md):
- [bambufy](https://github.com/function3d/bambufy) - Совместим с Bambu Studio, улучшает управление башней подачи, обеспечивает точную оценку времени и расхода материала, снижает отходы, поддерживает Mainsail,
быструю смену цвета и расширенные функции печати.
- [nopoop](https://github.com/ghzserg/nopoop) - Максимальное уменьшение количества отходов от ninjamida
- [lessWaste](https://github.com/Hrybmo/lessWaste/) - форк bambufy

---

[@zmod_help_bot](http://t.me/zmod_help_bot)

## **1. Важные особенности AD5X**

Отличия от AD5M:
*   Нет `Entware`
*   Вместо макроса `CLOSE_DILALOGS` (медленное закрытие) **всегда используйте** `FAST_CLOSE_DILAOGS` (быстрое закрытие).
*   Макрос `NEW_SAVE_CONFIG` **не работает**.
*   Чтобы включить камеру, нужно использовать ```CAMERA_ON VIDEO=video3``` или ```CAMERA_ON VIDEO=video0``` или ```CAMERA_ON VIDEO=video99```.
*   Возможен вылет Klipper. Решение `Профиль процесса` -> `Прочее` -> `Выходной G-cod` -> `Исключение моделей` выключить галочку.

---

## **2. Как подготовить файл в Orca AD5X**

[Отправляйте файлы на печать через "Octo/Klipper".](https://github.com/ghzserg/zmod/wiki/Recomendations#%D0%BE%D1%82%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D1%8F%D0%B9%D1%82%D0%B5-%D1%84%D0%B0%D0%B9%D0%BB%D1%8B-%D0%BD%D0%B0--%D0%BF%D0%B5%D1%87%D0%B0%D1%82%D1%8C-%D1%87%D0%B5%D1%80%D0%B5%D0%B7-octoklipper)


**Нужно удалить неиспользуемые катушки из списка в Orca.**

**Пример:**
В принтере 4 катушки (№1, №2, №3, №4). Для печати нужны только цвета с катушек №1 и №3.
*   В файле они будут называться **T0** (первый цвет) и **T1** (второй цвет).
*   В меню вам нужно будет выбрать для **T0** -> катушка №1, а для **T1** -> катушка №3.

---

## **3. Как пользоваться меню выбора цвета (макрос `COLOR`) AD5X**

<img width="874" height="286" alt="image" src="https://github.com/user-attachments/assets/c0538a17-88a9-4aee-a65c-cff4cc1773d0" />

<img width="800" height="480" alt="image" src="https://github.com/user-attachments/assets/b6eb3ddd-ad7d-4cc2-b1b5-9f1aef918b29" />


<img width="563" height="550" alt="image" src="https://github.com/user-attachments/assets/cc0c951f-48c1-469d-8940-90832ad1d3f5" />

<img width="800" height="480" alt="color" src="https://github.com/user-attachments/assets/4145baef-a695-49e6-a914-c12dd3f6b8a4" />

*   `Extruder: 1 (PETG/Orange)` – Это значит, что сейчас в принтер заправлен оранжевый пластик PETG из катушки номер 1.
*   `IFS: True` – Система автоматической подачи филамента работает.

**Теперь выберите катушку, с которой хотите работать (например, катушка 2):**

<img width="568" height="455" alt="image" src="https://github.com/user-attachments/assets/f7ea3ed0-28a5-48d5-99db-eade0a199e99" />

<img width="800" height="480" alt="screenshot" src="https://github.com/user-attachments/assets/c42cbefa-a29c-4df0-a62a-d99842c13961" />


Можно сделать четыре действия:
1.  **Изменить цвет** катушки.
2.  **Изменить тип** пластика (например, с PLA на PETG).
3.  **Загрузить** этот филамент в принтер.
4.  **Выгрузить** филамент из принтера.

**Как поменять цвет:**
1.  Нажмите «Изменить цвет».
2.  **Выберите цвет из списка.** Так принтер и родной экран поймут вас лучше всего.
<img width="561" height="823" alt="image" src="https://github.com/user-attachments/assets/8dbff228-dfc0-4705-92f9-d94df80b7a4e" />

<img width="800" height="480" alt="screenshot" src="https://github.com/user-attachments/assets/f51f91a2-4131-4ba3-a8a0-3b9519f61f6d" />

3.  После выбора вы вернетесь назад, и цвет катушки в списке **должен поменяться**.
<img width="556" height="545" alt="image" src="https://github.com/user-attachments/assets/f32a9239-44c6-449d-bbf7-5f453f149ef7" />

<img width="800" height="480" alt="screenshot" src="https://github.com/user-attachments/assets/4fa7bb58-ee03-4613-ba06-a5af9b2ddfa6" />

**Если цвет не поменялся:** закройте окно крестиком и запустите макрос `COLOR` снова. Иногда экран не успевает обновиться.

**Как поменять тип:**
1.  Нажмите «Изменить тип».
2.  **Выберите тип из списка.**

<img width="562" height="710" alt="image" src="https://github.com/user-attachments/assets/baf7b807-c4f5-4ab4-8bfd-2fc43bb448cd" />

<img width="800" height="480" alt="screenshot" src="https://github.com/user-attachments/assets/2d7b4f12-a8f1-4c99-a555-7c422bd5ffe4" />

**Если тип не поменялся:** закройте окно крестиком и запустите макрос `COLOR` снова. Иногда экран не успевает обновиться.

**Совет:** Если для нескольких катушек указать **одинаковый цвет и тип**, принтер будет автоматически переключаться на следующую катушку, когда первая закончится. Это называется **«режим бесконечной катушки»**.

---

## **4. Меню печати (макрос `PRINT`) AD5X**

Это окно открывается **само**, когда вы начинаете печать.
<img width="567" height="564" alt="image" src="https://github.com/user-attachments/assets/a046c089-22d3-474e-89b6-89815412d068" />

<img width="800" height="480" alt="screenshot" src="https://github.com/user-attachments/assets/f1ad0f49-e2bd-43c8-9301-7c58b9c05c22" />

**Как понять, что тут написано:**
*   `Cube.gcode` – это имя файла, который печатается.
*   `T0` – это первый цвет из файла. Он печатается филаментом из **катушки №4** (оранжевый PLA).
*   `T1` – это второй цвет. Он печатается филаментом из **катушки №3** (черный PLA).
*   `T2` – третий цвет, печатается с **катушки №2** (зеленый PLA).
*   `T3` – четвертый цвет, тоже печатается с **катушки №2** (зеленый PLA).

**Если нужно поменять катушку для цвета прямо во время печати:**
*   Просто **нажмите на нужный T** (например, T1) и выберите другую катушку из списка.
<img width="553" height="550" alt="image" src="https://github.com/user-attachments/assets/4d831fdb-6ff5-4a0d-ac9e-10154d1c7956" />

<img width="800" height="480" alt="screenshot" src="https://github.com/user-attachments/assets/a87d6115-87e4-4cb1-af3e-b194edefb42b" />

Чтобы окно выбора цвета не показывалось при начале печати используйте глобальный параметр [SILENT](https://github.com/ghzserg/zmod/wiki/Global_ru#silent)

- 0 - показывать окно (по умолчанию)
- 1 - не показывать окно, использовать ранее заданные цвета
- 2 - не показывать окно, не использовать IFS

```gcode
SAVE_ZMOD_DATA SILENT=1
```

## **5. Как вручную указать принтеру, какая катушка сейчас заправлена AD5X**

Бывает, что вы сами поменяли катушку, а принтер этого не понял и показывает старую информацию.

Чтобы это исправить, есть специальная команда.

**Просто напечатайте в консоли вот такую фразу:**

```
SET_EXTRUDER_SLOT SLOT=1
```

**Что это значит:**
*   `SET_EXTRUDER_SLOT` — это команда, которая говорит: «Принтер, запомни катушку!».
*   `SLOT=1` — это номер катушки, которую вы только что заправили. **Цифру можно менять!**

**Примеры:**
*   Если вы заправили филамент из катушки номер 3, напечатайте: `SET_EXTRUDER_SLOT SLOT=3`
*   Если из катушки номер 2, напечатайте: `SET_EXTRUDER_SLOT SLOT=2`

После этой команды принтер будет знать, какая катушка сейчас работает, и не перепутает цвета.

## **6. Как настроить количество отходов при смене филамента AD5X**

Эти настройки нужны, чтобы тратить меньше пластика при смене катушек. Чтобы их поменять, нужно сначала **отключить родной экран принтера** с помощью макроса `DISPLAY_OFF`.

В режиме без экрана доступны и включены датчики:
- `Head Switch Sensor` - наличия филамента в экструдере
- `Ifs Motion Sensor` - движения филамента в IFS

Для отключения функции автоматической вставки прутка в экструдер используйте глобальный параметр [AUTOINSERT](https://github.com/ghzserg/zmod/wiki/Global_ru#autoinsert)

```gcode
SAVE_ZMOD_DATA AUTOINSERT=0
```

Чтобы отключить сброс филамента в корзину при печати, используйте параметр [USE_TRASH_ON_PRINT](https://github.com/ghzserg/zmod/wiki/Global_ru#use_trash_on_print).

```gcode
SAVE_ZMOD_DATA USE_TRASH_ON_PRINT=0
```

Чтобы извлечь пруток после окончания печати, используйте параметр [REMOVE_FILAMENT](https://github.com/ghzserg/zmod/wiki/Global_ru#remove_filament).

```gcode
SAVE_ZMOD_DATA REMOVE_FILAMENT=1
```

Чтобы окно выбора цвета не показывалось при начале печати используйте глобальный параметр [SILENT](https://github.com/ghzserg/zmod/wiki/Global_ru#silent)

- 0 - показывать окно (по умолчанию)
- 1 - не показывать окно, использовать ранее заданные цвета
- 2 - не показывать окно, не использовать IFS

```gcode
SAVE_ZMOD_DATA SILENT=1
```

**Как найти эти настройки:**
1.  Нажмите на вкладку **«Конфигурация»**.
2.  Найдите и откройте папку **`mod_data`**.
3.  В этой папке найдите и откройте файл **`filament.json`**.

![Где найти файл](https://github.com/user-attachments/assets/109b0f0a-c87d-4f5c-9333-ebfbb8065b87)

В этом файле для каждого типа пластика (PLA, ABS, PETG и т.д.) есть список чисел. Вот что они значат:

---

#### **Самые важные настройки (что менять чаще всего) AD5X:**

Чтобы эти настройки работали, нужно **отключить родной экран принтера** с помощью макроса `DISPLAY_OFF`.

1.  **`temp`** — Температура, до которой разогревается сопло для смены филамента. **Значение по умолчанию зависит от типа материала.**
2.  **`filament_drop_length` (Длина сброса)**
    *   **Простыми словами:** Сколько миллиметров пластика принтер выдавит в мусорную корзину, чтобы **очистить сопло** от старого цвета.
    *   **Совет:** Если цвета при смене катушек смешиваются, увеличьте это число. Если хотите меньше отходов — уменьшите.

3.  **`filament_drop_length_add` (Дополнительный сброс)**
    *   **Простыми словами:** Сколько **ещё** пластика принтер выбросит в корзину, если вы меняете не просто цвет, а **тип материала** (например, с PLA на PETG).
    *   **Зачем это нужно:** Разные материалы плохо смешиваются, поэтому нужно чистить сопло лучше.
4.  **`nozzle_cleaning_length`** — Длина (в мм) на которую филамент вытягивается из экструдера при очистке сопла, когда катушка больше не используется. **По умолчанию: 60 мм.**
    *   Если у вас модуль 4 в 1 нового образца, то установите значение на 70 или больше

---

##### **Настройки для продвинутых (не меняйте, если не уверены в результате) AD5X:**

Чтобы эти настройки работали, нужно **отключить родной экран принтера** с помощью макроса `DISPLAY_OFF`.

*   **`filament_tube_length`** — Полная длина тефлоновой трубки от модуля IFS до экструдера. Полезно для нестандартных трубок. **По умолчанию: 1000 мм.**
*   **`filament_unload_before_cutting`** — На сколько миллиметров поднять филамент **перед** его обрезкой. **По умолчанию: 0 мм.**
*   **`filament_unload_after_cutting`** — На сколько миллиметров поднять филамент **после** обрезки, перед началом движения к корзине. **По умолчанию: 5 мм.**
*   **`filament_unload_after_drop`** — Ретракт (подтягивание) филамента назад после сброса в корзину перед печатью. Нужно для предотвращения подтекания сопла. **По умолчанию: 3 мм.**
*   **`filament_load_speed`** — Скорость (в мм/м), с которой филамент загружается в экструдер. **По умолчанию: 300 мм/м (5 мм/с).**
*   **`filament_unload_speed`** — Скорость (в мм/м), с которой филамент вытягивается из экструдера. Модуль IFS при этом работает в 2 раза быстрее. **По умолчанию: 600 мм/м (10 мм/с).**
*   **`filament_fan_speed`** — Скорость работы вентилятора (от 0 до 255) при сбросе в корзину. Он обдувает сопло, чтобы охладить подтёки. **По умолчанию: 102.**
*   **`filament_autoinsert_empty_length`** — Сколько миллиметров филамента затягивается при автоматической заправке, если экструдер пустой. **По умолчанию: 600 мм.**
*   **`filament_autoinsert_full_length`** — Сколько миллиметров филамента затягивается при автоматической заправке, если в экструдере уже был другой филамент. **По умолчанию: 550 мм.**
*   **`filament_autoinsert_ret_length`** — На сколько миллиметров втянуть филамент обратно, если сработал датчик в экструдере (только при пустом экструдере). **По умолчанию: 90 мм.**
*   **`filament_autoinsert_speed`** — Скорость (в мм/м) автоматической подачи филамента в экструдер. **По умолчанию: 1200 мм/м (20 мм/с).**

**Внимание!** Изменение параметров в разделе для продвинутых может привести к некорректной работе принтера, замятиям филамента или поломкам. Меняйте их только в том случае, если вы полностью понимаете, за что отвечает каждый параметр и каковы могут быть последствия.

**Главный вывод:** Если хотите меньше отходов — начните с уменьшения чисел **`filament_drop_length`** и **`filament_drop_length_add`** для вашего пластика. Не забывайте сохранять файл после изменений!

## **7. Добавить свои типы филамента AD5X**

Чтобы эти настройки работали, нужно **отключить родной экран принтера** с помощью макроса `DISPLAY_OFF`.

Для добавления нового типа филамента ```mod_data/user.cfg``` добавить:
```
[zmod_ifs]
filament_NEWTYPE: 300
```
Где NEWTYPE заменить на нужный вам тип филамента (например HIPS), а число - это температура плавления этого филамента.

```IFS_PRINT_DEFAULTS``` - выведет доступные типы филамента и их температуры плавления

---

## **8. Добавить свои цвета AD5X**

Чтобы эти настройки работали, нужно **отключить родной экран принтера** с помощью макроса `DISPLAY_OFF`.

Для добавления или переименования цвета откройте ```mod_data/colors/ru.cfg``` (вместо ru использовать ваш язык):

И добавьте новый цвет или переименуйте существующий.

Чтобы выводилось название цвета, имя цвета должно начинаться с нижнего подчеркивания ```_```

Пример:
```
{
  "ffffff": "белый",
  "fffff1": "_прозрачный",
  "fef043": "ярко-желтый",
  "dcf478": "светло-зеленый",
  "0acc38": "зеленый",
  "067749": "темно-зеленый",
  "0c6283": "сине-зеленый",
  "0de2a0": "бирюзовый",
  "75d9f3": "голубой",
  "45a8f9": "синий",
  "2750e0": "темно-синий",
  "46328e": "фиолетовый",
  "a03cf7": "ярко-фиолетовый",
  "f330f9": "пурпурный",
  "d4b0dc": "сиреневый",
  "f95d73": "розовый",
  "f72224": "красный",
  "7c4b00": "коричневый",
  "f98d33": "оранжевый",
  "fdebd5": "бежевый",
  "d3c4a3": "светло-коричневый",
  "af7836": "терракотовый",
  "898989": "серый",
  "bcbcbc": "светло-серый",
  "161616": "черный"
}
```

Надпись ```_прозрачный``` будет выводиться на кнопках

---

## 9. Исправление работы с корзиной и ножом для отрезания филамента AD5X

[Альтернативный вариант инструкции](https://github.com/ghzserg/zmod/wiki/Setup#%D0%B2%D0%BD%D0%B8%D0%BC%D0%B0%D0%BD%D0%B8%D0%B5-ad5x)

У разных принтеров AD5X координаты корзины и ножа могут быть разными. Иногда разница доходит до 4 мм. 

Из-за этого:
- Филамент может не попасть в корзину;
- Нож не отрезает филамент;
- Голова принтера может удариться о стенку.

Чтобы это исправить, нужно:
1. Обновить zMod.
2. Открыть файл `‎/rw/Adventurer5M.json`.
3. Найти такие строки:
```json
{
	"CutXOffset" : 0.5,
	"CutYOffset" : -0.20000001788139343,
	"xOffset" : 0.0,
	"yOffset" : -0.20000001788139343,
	"zOffset" : 0.0,
	"zProbeOffset" : 0.004999995231628418
},
```
<img width="504" height="241" alt="image" src="https://github.com/user-attachments/assets/8647b1fe-594c-4bb3-91ee-560cfe4a58fd" />

Заменить **только** эти значения:
```json
"CutXOffset": 0.0,
"CutYOffset": 0.0,
"yOffset": 0.0,
```
4. Ввести команду: `UPDATE_FF_OFFSET` (это обновит настройки).
5. Потом ввести: `_GOTO_TRASH` (это вернет принтер в корзину).

---

### Настройка корзины AD5X

[Альтернативный вариант инструкции](https://github.com/ghzserg/zmod/wiki/Setup#%D0%B2%D0%BD%D0%B8%D0%BC%D0%B0%D0%BD%D0%B8%D0%B5-ad5x)

1. Введите команду `_GOTO_TRASH` — голова принтера поедет к корзине.
2. Если корзина не закрылась, аккуратно подвиньте голову, пока корзина не закроется. Нужно использовать GCODE: ```G1 Y230.2```
3. Посмотрите, какая координата **Y** у вас теперь.
4. Отнимите от этого числа 229. Результат и будет вашим `yOffset`.

Примеры:
- Если Y = 230.2, то `yOffset = 230.2 - 229 = 1.2`
- Если Y = 228.4, то `yOffset = 228.4 - 229 = -0.6`
- Формула: `yOffset = Y - 229`

Запишите это число в файл `‎/rw/Adventurer5M.json`. Корзина настроена.

5. Ввести команду: `UPDATE_FF_OFFSET` (это обновит настройки).
6. Потом ввести: `_GOTO_TRASH` (это вернет принтер в корзину).

---

### Настройка ножа AD5X

[Альтернативный вариант инструкции](https://github.com/ghzserg/zmod/wiki/Setup#%D0%B2%D0%BD%D0%B8%D0%BC%D0%B0%D0%BD%D0%B8%D0%B5-ad5x)

1. Введите команду `_CUT_PRUTOK` — голова поедет к ножу.
2. С помощью экрана подвиньте голову, пока нож не сработает. Нужно использовать GCODE: ```G1 Y-7.7``` ```G1 X-1.7```
3. Посмотрите, какие у вас координаты X и Y.
4. Для **Y**:
   - Отнимите от **7.5** вашу Y-координату по модулю.
   - Пример: если Y = -7.7, то `CutYOffset = 7.5 - 7.7 = -0.2`
   - Пример: если Y = -5.9, то `CutYOffset = 7.5 - 5.9 = 1.6`
   - Формула: `CutYOffset = 7.5 + Y`

5. Для **X**:
   - Отнимите от **2.5** вашу X-координату по модулю.
   - Пример: если X = -1.7, то `CutXOffset = 2.5 - 1.7 = 0.8`
   - Пример: если X = -2.8, то `CutXOffset = 2.5 - 2.8 = -0.3`
   - Формула: `CutXOffset = 2.5 + X`

Запишите эти числа в файл `‎/rw/Adventurer5M.json`. Нож настроен.

6. Ввести команду: `UPDATE_FF_OFFSET` (это обновит настройки).
7. Потом ввести: `_GOTO_TRASH` (это вернет принтер в корзину).

Перезагрузите принтер — всё готово.

---

## Настройка корзины на родной прошивке AD5X

1. Перейти на вкладку "i" и нажать кнопку `Status`
   
   <img width="800" height="480" alt="image" src="https://github.com/user-attachments/assets/08a99d33-c970-4e86-933d-0064b447f5b7" />
2. Перейти на 6 вкладку
   
   <img width="800" height="480" alt="image" src="https://github.com/user-attachments/assets/a0eb4b8f-552b-4e58-86d7-2b47b8b0035c" />

3. Зажмите `Move the extruder to waste tray position` и держите 20 секунд
   <img width="800" height="480" alt="image" src="https://github.com/user-attachments/assets/81213d65-bf06-4d33-8e4a-eb3aae2782d7" />

4. Отрегулируйте положение головы в корзине, так чтобы она закрывалась. Стрелками управления припарковать печатающую голову к приемнику таким образом, чтобы печатающая голова достаточно прижимала рычажок шторки, сопло было за подвижной шторкой, а сама шторка была на одном уровне с передней поверхностью приемника.
   
   <img width="800" height="480" alt="image" src="https://github.com/user-attachments/assets/7b506200-0d61-4b88-aaf8-40475e3ad463" />
   
   Нажмите  кнопку `Set`

5. Зажмите `Move the extruder to cutter stiker position` и держите 20 секунд
   <img width="800" height="480" alt="image" src="https://github.com/user-attachments/assets/e61c61c0-f1a1-4535-b9ef-37baa4ab1d8c" />

4. Отрегулируйте нож. Нажмите `CutX` - нож должен отрезать филамент без сдвигов и ударов.
   
   <img width="800" height="480" alt="image" src="https://github.com/user-attachments/assets/a0c1939e-dada-48cb-8789-df43999bf99b" />
   
   Нажмите  кнопку `Set`

---

## **10. IFS команды**

Чтобы эти настройки работали, нужно **отключить родной экран принтера** с помощью макроса `DISPLAY_OFF`.

- `IFS_F10` - Вставить пруток
- `IFS_F11` - Извлечь пруток
- `IFS_F13` - Состояние IFS
- `IFS_F15` - Сброс драйвера
- `F18` - Отжим филамента везде
- `F23` - Помечаем пруток как вставленный
- `F24` - Прижим филамента
- `F39` - Отжим филамента
- `F112` - Прекращаем подачу прутка
- `PURGE_PRUTOK_IFS` - Очистить пруток от IFS до экструдера
- `REMOVE_PRUTOK_IFS` - Удаляет пруток по номеру прутка
- `INSERT_PRUTOK_IFS` - Вставить пруток в IFS по номеру прутка
- `SET_CURRENT_PRUTOK` - Указать klipper какой пруток сейчас активен
- `ANALOG_PRUTOK` - Загрузить аналогичный пруток
- `IFS_MOTION` - Проверить, остановился или кончился филамент

Параметры модуля IFS:
- debug - отладка (True, *False*)
- silk_count - с какой попытки зачитывать что пруток в IFS (*1*)
- stall_count - с какой попытки засчитывать что пруток остановилося (*1*)
- retry_count - сколько раз повторять команду при ошибке (*3*)
- filament_NEWFILEMENT - добавить новый тип филамента параметр - температруа замены этого типа пластика.

Задаются через `mod_data/user.cfg`:
```
[zmod_ifs]
debug: True
silk_count: 1
stall_count: 1
filament_NEWTYPE: 300
```

## **11. Восстановление прошивки IFS**

Для восстановления прошивки IFS нужен программатор **ARM J-LINK V9**

<img width="800" height="800" alt="image" src="https://github.com/user-attachments/assets/ae91768b-00d8-4e36-a62d-3056a7e117bf" />

<img width="960" height="479" alt="image" src="https://github.com/user-attachments/assets/f623fa41-4bc3-40a4-a434-5d8ad717792b" />

Припаиваем провода к плате iFS

<img width="579" height="774" alt="image" src="https://github.com/user-attachments/assets/cb2b2f72-9eba-4831-8cea-072813b6e0e3" />

Подключаем:
- CLK к SWCK
- DIO к SWIO
- VCC к 3.3
- GND к GND

<img width="346" height="390" src="https://github.com/user-attachments/assets/19438d58-9879-48e5-8acc-bfb21ce4549c" />

- Target Device - `Nations N32G455RE`
- Target interface: `SWD`
- Speed: `4000`
- Ставим первую галочку
- Вторую галочку снимаем

1. Соединяемся
2. Вбираем [файл для прошивки](https://github.com/ghzserg/zmod/wiki/Native_FW_ru#5x-ifs). **Не забудьте его разархивировать**.
3. Нажимаем **F7** и ждем прошивки устройства

## IFS: sensor error: Serial communication error: read failed: device reports readiness to read but returned no data (device disconnected or multiple access on port?)

Эта ошибка, возникает когда родной экран и мод одновременно обращаются к IFS.

Лучше  всего уменьшить время жизни родного экрана до 10 секунд: ```SAVE_ZMOD_DATA DISPLAY_OFF_TIMEOUT=10```
